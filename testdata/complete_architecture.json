{
  "metadata": {
    "version": "1.0",
    "name": "complete-aws-architecture",
    "description": "Simple AWS architecture with VPC, EC2 instances, RDS database, and S3 bucket",
    "environment": "production"
  },
  "nodes": [
    {
      "id": "vpc-main",
      "type": "vpc",
      "label": "Main VPC",
      "position": { "x": 400, "y": 80 },
      "properties": {
        "cidr_block": "10.0.0.0/16",
        "enable_dns_hostnames": true,
        "enable_dns_support": true,
        "tags": {
          "Name": "main-vpc",
          "Environment": "production",
          "Tier": "network"
        }
      }
    },
    {
      "id": "subnet-public-1a",
      "type": "subnet",
      "label": "Public Subnet 1a",
      "position": { "x": 200, "y": 220 },
      "properties": {
        "cidr_block": "10.0.1.0/24",
        "availability_zone": "us-east-1a",
        "map_public_ip_on_launch": true,
        "tags": {
          "Name": "public-1a",
          "Type": "public"
        }
      }
    },
    {
      "id": "subnet-public-1b",
      "type": "subnet",
      "label": "Public Subnet 1b",
      "position": { "x": 600, "y": 220 },
      "properties": {
        "cidr_block": "10.0.2.0/24",
        "availability_zone": "us-east-1b",
        "map_public_ip_on_launch": true,
        "tags": {
          "Name": "public-1b",
          "Type": "public"
        }
      }
    },
    {
      "id": "subnet-private-1a",
      "type": "subnet",
      "label": "Private Subnet 1a",
      "position": { "x": 200, "y": 380 },
      "properties": {
        "cidr_block": "10.0.10.0/24",
        "availability_zone": "us-east-1a",
        "tags": {
          "Name": "private-1a",
          "Type": "private"
        }
      }
    },
    {
      "id": "sg-web",
      "type": "security_group",
      "label": "Web Security Group",
      "position": { "x": 400, "y": 320 },
      "properties": {
        "name": "web-sg",
        "description": "Allow HTTP/HTTPS and SSH for web instances",
        "ingress": [
          {
            "from_port": 80,
            "to_port": 80,
            "protocol": "tcp",
            "cidr_blocks": ["0.0.0.0/0"],
            "description": "HTTP"
          },
          {
            "from_port": 443,
            "to_port": 443,
            "protocol": "tcp",
            "cidr_blocks": ["0.0.0.0/0"],
            "description": "HTTPS"
          },
          {
            "from_port": 22,
            "to_port": 22,
            "protocol": "tcp",
            "cidr_blocks": ["10.0.0.0/16"],
            "description": "SSH from VPC"
          }
        ],
        "egress": [
          {
            "from_port": 0,
            "to_port": 0,
            "protocol": "-1",
            "cidr_blocks": ["0.0.0.0/0"],
            "description": "All outbound"
          }
        ],
        "tags": {
          "Name": "web-sg"
        }
      }
    },
    {
      "id": "sg-db",
      "type": "security_group",
      "label": "Database Security Group",
      "position": { "x": 400, "y": 500 },
      "properties": {
        "name": "db-sg",
        "description": "Allow PostgreSQL from VPC only",
        "ingress": [
          {
            "from_port": 5432,
            "to_port": 5432,
            "protocol": "tcp",
            "cidr_blocks": ["10.0.0.0/16"],
            "description": "PostgreSQL from VPC"
          }
        ],
        "egress": [
          {
            "from_port": 0,
            "to_port": 0,
            "protocol": "-1",
            "cidr_blocks": ["0.0.0.0/0"]
          }
        ],
        "tags": {
          "Name": "db-sg"
        }
      }
    },
    {
      "id": "ec2-web-1",
      "type": "ec2_instance",
      "label": "Web Server 1",
      "position": { "x": 200, "y": 280 },
      "properties": {
        "ami": "ami-0c55b159cbfafe1f0",
        "instance_type": "t3.small",
        "key_name": "my-key",
        "associate_public_ip_address": true,
        "root_block_device": {
          "volume_size": 20,
          "volume_type": "gp3"
        },
        "tags": {
          "Name": "web-server-1",
          "Role": "web",
          "Environment": "production"
        }
      }
    },
    {
      "id": "ec2-web-2",
      "type": "ec2_instance",
      "label": "Web Server 2",
      "position": { "x": 600, "y": 280 },
      "properties": {
        "ami": "ami-0c55b159cbfafe1f0",
        "instance_type": "t3.small",
        "key_name": "my-key",
        "associate_public_ip_address": true,
        "tags": {
          "Name": "web-server-2",
          "Role": "web",
          "Environment": "production"
        }
      }
    },
    {
      "id": "rds-main",
      "type": "rds_instance",
      "label": "PostgreSQL Database",
      "position": { "x": 400, "y": 440 },
      "properties": {
        "engine": "postgres",
        "engine_version": "15.4",
        "instance_class": "db.t3.micro",
        "allocated_storage": 20,
        "storage_type": "gp3",
        "db_name": "appdb",
        "username": "dbadmin",
        "password": "CHANGE_ME_USE_VARIABLE",
        "skip_final_snapshot": true,
        "backup_retention_period": 7,
        "multi_az": false,
        "tags": {
          "Name": "main-postgres",
          "Role": "database",
          "Environment": "production"
        }
      }
    },
    {
      "id": "s3-app-data",
      "type": "s3_bucket",
      "label": "Application Data Bucket",
      "position": { "x": 400, "y": 600 },
      "properties": {
        "bucket": "my-app-data-bucket-unique-12345",
        "versioning": true,
        "block_public_acls": true,
        "block_public_policy": true,
        "force_destroy": false,
        "tags": {
          "Name": "app-data",
          "Purpose": "uploads-and-assets",
          "Environment": "production"
        }
      }
    }
  ],
  "edges": [
    { "id": "e1", "source": "vpc-main", "target": "subnet-public-1a", "type": "contains" },
    { "id": "e2", "source": "vpc-main", "target": "subnet-public-1b", "type": "contains" },
    { "id": "e3", "source": "vpc-main", "target": "subnet-private-1a", "type": "contains" },
    { "id": "e4", "source": "vpc-main", "target": "sg-web", "type": "contains" },
    { "id": "e5", "source": "vpc-main", "target": "sg-db", "type": "contains" },
    { "id": "e6", "source": "subnet-public-1a", "target": "ec2-web-1", "type": "contains" },
    { "id": "e7", "source": "subnet-public-1b", "target": "ec2-web-2", "type": "contains" },
    { "id": "e8", "source": "sg-web", "target": "ec2-web-1", "type": "connects_to" },
    { "id": "e9", "source": "sg-web", "target": "ec2-web-2", "type": "connects_to" },
    { "id": "e10", "source": "sg-db", "target": "rds-main", "type": "connects_to" }
  ]
}
